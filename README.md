# Бот приёма и маршрутизации заказов

Телеграм-бот для приёма заявок на поездки/доставку, автоматического сбора данных от пользователя и пересылки заказов администраторам. Поддерживается подключение собственных ботов партнёрами: заказы пересылаются в основной бот, а подключившему партнёру начисляется комиссия.

## Возможности

- Приветствие по `/start` с праздничными инлайн-кнопками на канал, оператора и чат.
- Телеграмный UX: ForceReply с подсказкой «Такси от Майка», аккуратные клавиатуры, редактирование сообщений вместо спама, анимации ожидания через `sendChatAction`.
- Простое меню: оформление заказа, помощь, профиль с балансом и коэффициентом, избранные адреса.
- Сценарий заказа: город, адреса, тариф, доп. услуги (детское кресло и др.), комментарий, загрузка скриншота.
- Выбор и подтверждение оплаты: карта/СБП/криптовалюты, загрузка чека, пересылка в админ-канал.
- Админ-панель: поиск заказов, рассылка (текст/фото), управление статусами, обработка оплат, бан пользователей.
- Реферальные начисления 15 % тому, кто подключил бота, при создании заказов через его токен.
- Автозапуск всех сохранённых ботов: основной токен и подключённые партнёры стартуют параллельно.
- Отдельное хранилище `podmena.db` для записей подмены с кнопкой очистки в админке.
- Логирование в файл (`bot.log`) и консоль с поддержкой Unicode-эмодзи.

## Структура

- `main.py` — Telegram-бот на `python-telegram-bot` с пользователями, заказами, оплатами и админкой.
- `cfg.py` — пользовательские настройки (токены, каталоги, платежные реквизиты), могут быть переопределены переменными окружения.
- `requirements.txt` — зависимости проекта.
- `LICENSE` — текст лицензии Apache 2.0.

## Настройка окружения

Укажите ключевые параметры через переменные окружения или в `cfg.py`:
- `BOT_TOKEN` — токен бота по умолчанию (используется и как основной, если не задан `PRIMARY_BOT_TOKEN`).
- `PRIMARY_BOT_TOKEN` — токен основного бота, который принимает заказы от подключённых партнёров.
- `CHANNEL_URL`, `OPERATOR_URL`, `CHAT_URL` — ссылки для инлайн-кнопок в `/start` (по умолчанию заданы новогодние значения).
- `DB_PATH`, `SCREENSHOTS_DIR`, `DB_DIR` — пути к базе и хранилищам файлов.
- `TRANSFER_DETAILS`, `SBP_DETAILS`, `SBP_BANK_INFO`, `LTC_WALLET`, `USDT_TRC20_WALLET`, `USDT_TRX_WALLET` — реквизиты для оплаты.

## Установка

```bash
python -m venv .venv
source .venv/bin/activate  # или .venv\\Scripts\\activate в Windows
pip install -r requirements.txt
```

## Запуск

- Telegram-бот:
```bash
python main.py
```

## Тесты

Минимальная проверка синтаксиса:
```bash
python -m compileall main.py
```

## Лицензия

Проект распространяется по лицензии Apache 2.0. Полный текст — в файле [`LICENSE`](LICENSE).
